# Frankfurt Scale 问卷提交功能修复

## 问题描述
Frankfurt Scale of Selective Mutism.html 文件原本只有本地存储功能，没有向后端系统提交数据的功能。

## 修复内容

### 1. 添加提交按钮
在问卷页面的两个位置添加了"提交到系统"按钮：
- A部分（快速筛查）区域
- B部分（说话情况评分）区域

### 2. 实现数据提交功能
添加了 `submitToServer()` 函数，具备以下功能：

#### 数据验证
- 检查必填字段（儿童姓名、日期）
- 验证问卷完成度（至少完成一半的筛查问题）

#### 数据转换
- 将前端的问卷数据转换为后端API期望的格式
- 包含基本信息、问题答案、统计数据

#### 错误处理
- 网络错误处理
- 服务器错误处理
- 提供备用方案（导出到本地文件）

### 3. 服务器连接检查
添加了 `checkServerConnection()` 函数，在页面加载时检查后端服务器状态。

## 数据结构

### 提交的数据格式
```json
{
  "type": "frankfurt_scale_selective_mutism",
  "basic_info": {
    "name": "儿童姓名",
    "grade": "年龄组",
    "submission_date": "提交日期",
    "guardian": "家长姓名"
  },
  "questions": [
    {
      "id": 1,
      "type": "multiple_choice",
      "section": "diagnostic_scale",
      "question": "问题内容",
      "question_en": "英文问题",
      "options": [...],
      "selected": [1],
      "answer": "答案",
      "score": 1
    }
  ],
  "statistics": {
    "age_group": "6_11",
    "ds_total_score": 8,
    "ds_cutoff": 7,
    "ss_school_score": 15,
    "ss_public_score": 12,
    "ss_home_score": 2,
    "ss_total_score": 29,
    "risk_level": "high",
    "completion_rate": 85
  }
}
```

## 使用方法

### 1. 启动后端服务
```bash
cd backend
python app.py
```

### 2. 打开问卷页面
在浏览器中打开 `Frankfurt Scale of Selective Mutism.html`

### 3. 填写问卷
1. 点击"开始填写"
2. 填写儿童基本信息
3. 完成A部分（快速筛查）
4. 完成B部分（说话情况评分）

### 4. 提交数据
点击"提交到系统"按钮，系统会：
1. 验证必填信息
2. 检查完成度
3. 发送数据到后端
4. 显示提交结果

## 测试方法

### 1. 运行自动化测试
```bash
python test_frankfurt_submit.py
```

### 2. 手动测试步骤
1. 确保后端服务运行正常
2. 打开问卷页面
3. 填写测试数据
4. 点击提交按钮
5. 检查提交结果

### 3. 验证数据存储
登录管理页面查看提交的问卷数据：
```
http://localhost:5000/admin
用户名: admin
密码: admin123
```

## 错误处理

### 常见错误及解决方案

#### 1. "请填写儿童姓名"
- 确保在基本信息中填写了儿童姓名

#### 2. "请选择日期"
- 确保选择了提交日期

#### 3. "请至少完成一半的筛查问题"
- 至少完成5个DS部分的问题

#### 4. "网络错误"
- 检查后端服务是否运行
- 确认服务器地址正确 (http://localhost:5000)
- 检查网络连接

#### 5. "提交失败"
- 查看具体错误信息
- 检查数据格式是否正确
- 查看后端日志

## 备用方案

如果网络提交失败，系统会提供备用选项：
1. 导出数据到JSON文件
2. 稍后手动导入到系统

## 技术细节

### API端点
- 提交地址: `POST /api/submit`
- 状态检查: `GET /api/auth/status`

### 数据验证
- 前端验证：必填字段、完成度
- 后端验证：数据格式、业务规则

### 兼容性
- 支持所有现代浏览器
- 兼容原有的本地存储功能
- 不影响导出功能

## 更新日志

### v1.0 (2024-01-15)
- ✅ 添加数据提交功能
- ✅ 实现错误处理
- ✅ 添加服务器连接检查
- ✅ 创建测试脚本
- ✅ 保持向后兼容性

## 注意事项

1. **数据安全**: 提交的数据会存储在后端数据库中
2. **网络要求**: 需要能够访问后端服务器
3. **浏览器兼容**: 建议使用Chrome、Firefox、Safari等现代浏览器
4. **数据备份**: 建议定期备份问卷数据
5. **隐私保护**: 确保儿童信息的隐私安全
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°å­¦æŠ¥å‘Šè¡¨æ ¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="config.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Nunito', sans-serif;
        }

        :root {
            --primary-color: #6B7280;
            --secondary-color: #F3F4F6;
            --accent-color: #8B5CF6;
            --text-color: #374151;
            --light-accent: #EDE9FE;
            --bg-gradient: linear-gradient(135deg, #F9FAFB 0%, #F3F4F6 100%);
        }

        body {
            background: var(--bg-gradient);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            background-color: white;
        }

        .header {
            background: linear-gradient(135deg, #8B5CF6 0%, #6D28D9 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
        }

        .title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .main-content {
            padding: 30px 40px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            border-radius: 15px;
            background-color: var(--secondary-color);
        }

        .section-title {
            color: var(--accent-color);
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-accent);
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 10px;
        }

        .info-form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-color);
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #E5E7EB;
            transition: border-color 0.3s ease;
            background-color: white;
            font-size: inherit;
            font-family: inherit;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        
        .privacy-note {
            background-color: var(--light-accent);
            color: var(--accent-color);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .button-container {
            text-align: center;
            margin-top: 40px;
        }

        .btn {
            padding: 12px 28px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-primary:disabled {
            background-color: #D1D5DB;
            cursor: not-allowed;
        }

        .btn-primary:hover:not(:disabled) {
            background-color: #7C3AED;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }
        
        .btn-secondary {
            background-color: white;
            color: var(--primary-color);
            border: 2px solid var(--secondary-color);
        }

        .btn-secondary:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }

        .question-container, .summary-container {
            display: none;
        }
        
        .question-card, .summary-item {
            padding: 25px;
            border-radius: 15px;
            background-color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.03);
            margin-bottom: 30px;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-category {
            background-color: var(--light-accent);
            color: var(--accent-color);
            padding: 5px 15px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .question-number {
            color: var(--primary-color);
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        /* å®Œæˆé¡µé¢æ ·å¼ */
        .completion-page {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .completion-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .completion-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .completion-header h1 {
            color: #28a745;
            margin-bottom: 10px;
        }
        
        .completion-subtitle {
            color: #6c757d;
            font-size: 1.1em;
        }
        
        .info-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
       
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .completion-answers {
            margin: 30px 0;
        }
        
        .answers-list {
            background: #fff;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            overflow: hidden;
        }
        
        .answer-section {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .answer-section h4 {
            margin: 0;
            color: #495057;
        }
        
        .answer-item {
            padding: 20px;
            border-bottom: 1px solid #f1f3f4;
        }
        
        .answer-item:last-child {
            border-bottom: none;
        }
        
        .answer-question {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .answer-content {
            color: #555;
            line-height: 1.6;
            background: #fafbfc;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .completion-actions {
            text-align: center;
            margin-top: 30px;
        }
        
        .btn-primary, .btn-secondary {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .question-content {
            display: flex;
            gap: 30px;
        }
        
        .options-container {
            flex: 2;
        }
        
        .textarea-input {
            width: 100%;
            min-height: 150px;
            padding: 15px;
        }
        
        .rating-scale { margin-bottom: 20px; }
        .rating-scale-label { font-weight: 600; margin-bottom: 10px; display: block; }
        .rating-options { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 10px; padding: 10px; background-color: #f9fafb; border-radius: 8px;}
        .rating-option label { display: flex; flex-direction: column; align-items: center; cursor: pointer; font-size: 0.9rem; text-align: center; min-width: 60px;}
        .rating-option input { margin-bottom: 5px; width: 18px; height: 18px; accent-color: var(--accent-color);}
        
        .question-explanation {
            flex: 1;
            max-width: 350px;
            background-color: #F9FAFB;
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid var(--accent-color);
            font-size: 0.95rem;
        }

        .explanation-title {
            color: var(--accent-color);
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
        }

        .summary-question {
            font-weight: 600;
            color: var(--accent-color);
            margin-bottom: 8px;
        }
        
        .summary-answer {
            white-space: pre-wrap;
            background-color: var(--secondary-color);
            padding: 10px;
            border-radius: 8px;
            color: var(--text-color);
        }

        .footer {
            text-align: center;
            padding: 30px;
            color: var(--primary-color);
            font-size: 0.9rem;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in { animation: fadeIn 0.6s ease-out forwards; }
        
        @media (max-width: 992px) {
            .question-content { flex-direction: column; }
            .question-explanation { max-width: 100%; margin-top: 20px; }
        }
    </style>
</head>
<body>
    <div class="container fade-in">
        <div class="header">
            <h1 class="title">å°å­¦æŠ¥å‘Šè¡¨æ ¼</h1>
        </div>

        <div class="main-content">
            <div id="welcome-page">
                <div class="section">
                    <h2 class="section-title"><i class="fa fa-file-text-o"></i> æŠ¥å‘Šä¿¡æ¯</h2>
                    <div id="info-form" class="info-form-grid">
                        <div class="form-group"><label for="childName">å§“å</label><input type="text" id="childName" required></div>
                        <div class="form-group"><label for="dob">å‡ºç”Ÿæ—¥æœŸ</label><input type="date" id="dob" required></div>
                        <div class="form-group"><label for="gender">æ€§åˆ«</label><select id="gender" required><option value="">è¯·é€‰æ‹©</option><option value="ç”·">ç”·</option><option value="å¥³">å¥³</option></select></div>
                        <div class="form-group"><label for="gradeLevel">å¹´çº§</label><input type="text" id="gradeLevel" placeholder="å¦‚ï¼šä¸‰å¹´çº§" required></div>
                        <div class="form-group"><label for="schoolName">å­¦æ ¡</label><input type="text" id="schoolName" required></div>
                        <div class="form-group"><label for="admissionDate">å…¥å­¦æ—¥æœŸ</label><input type="date" id="admissionDate" required></div>
                        <div class="form-group" style="grid-column: 1 / -1;"><label for="address">åœ°å€</label><input type="text" id="address" required></div>
                        <hr style="grid-column: 1 / -1; border-top: 2px solid var(--light-accent); margin: 10px 0;">
                        <div class="form-group"><label for="parentPhone">å®¶é•¿æ‰‹æœºå·</label><input type="tel" id="parentPhone" placeholder="å¯é€‰"></div>
                        <div class="form-group"><label for="parentWechat">å®¶é•¿å¾®ä¿¡</label><input type="text" id="parentWechat" placeholder="å¯é€‰"></div>
                        <div class="form-group"><label for="parentEmail">å®¶é•¿é‚®ç®±</label><input type="email" id="parentEmail" placeholder="å¯é€‰"></div>
                        <hr style="grid-column: 1 / -1; border-top: 2px solid var(--light-accent); margin: 10px 0;">
                        <div class="form-group"><label for="fillerName">å¡«è¡¨äººå§“å</label><input type="text" id="fillerName" required></div>
                        <div class="form-group"><label for="fillDate">å¡«è¡¨æ—¥æœŸ</label><input type="date" id="fillDate" required></div>
                    </div>
                    <div class="privacy-note">
                        <strong>éšç§ä¿éšœåå®š:</strong> æˆ‘ä»¬å‘ç°,æœ‰æ—¶ä¸å®¶é•¿å’Œå­©å­è®¨è®ºå­¦æ ¡æŠ¥å‘Šè¡¨æ ¼ä¼šå¯¹å¹²é¢„æ²»ç–—å¾ˆæœ‰å¸®åŠ©ã€‚ä»»ä½•ä½ ä¸å¸Œæœ›ä¸å­©å­çš„å®¶äººè®¨è®ºçš„éƒ¨åˆ†,è¯·åœ¨æŠ¥å‘Šä¸Šæ˜ç¡®æ ‡è®°ã€‚æˆ‘ä»¬å°†å°Šé‡ä½ çš„æ„æ„¿ã€‚
                    </div>
                </div>

                <div class="button-container">
                    <button id="start-btn" class="btn btn-primary" disabled><i class="fa fa-arrow-right"></i> å¼€å§‹å¡«å†™æŠ¥å‘Š</button>
                </div>
            </div>

            <div id="questions-container" class="question-container">
                <div id="question-card"></div>
                <div class="navigation-buttons">
                    <button id="prev-btn" class="btn btn-secondary" disabled><i class="fa fa-arrow-left"></i> ä¸Šä¸€é¢˜</button>
                    <button id="next-btn" class="btn btn-primary">ä¸‹ä¸€é¢˜ <i class="fa fa-arrow-right"></i></button>
                </div>
            </div>

            <div id="summary-container" class="summary-container">
                <div class="section">
                    <h2 class="section-title"><i class="fa fa-check-square-o"></i> æŠ¥å‘Šå†…å®¹æ‘˜è¦</h2>
                    <div id="summary-info"></div>
                    <div id="summary-content"></div>
                </div>
                <div class="button-container">
                    <button id="restart-btn" class="btn btn-secondary"><i class="fa fa-refresh"></i> é‡æ–°å¡«å†™</button>
                    <button id="save-result-btn" class="btn btn-primary"><i class="fa fa-save"></i> ä¿å­˜ç»“æœ</button>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>&copy; 2025 ä¸“ä¸šå¿ƒç†è¯„ä¼°æ”¯æŒç³»ç»Ÿ</p>
        </div>
    </div>

    <script>
        // --- 1. DOM Elements & State ---
        const welcomePage = document.getElementById('welcome-page');
        const questionsContainer = document.getElementById('questions-container');
        const summaryContainer = document.getElementById('summary-container');
        const questionCard = document.getElementById('question-card');
        const startBtn = document.getElementById('start-btn');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const restartBtn = document.getElementById('restart-btn');

        let currentQuestionIndex = 0;
        const userAnswers = {};
        let reportInfo = {};

        // --- 2. Data Source (from DOCX) ---
        const questions = [
            { id: 101, category: '1. è¿‡å»å°±è¯»å­¦æ ¡çš„ä¿¡æ¯', type: 'textarea', text: 'å­©å­å°±è¯»è¿‡çš„å­¦æ ¡ä»¥åŠå°±è¯»æ—¶é—´', explanation: '' },
            { id: 102, category: '1. è¿‡å»å°±è¯»å­¦æ ¡çš„ä¿¡æ¯', type: 'textarea', text: 'æ˜¯å¦æœ‰ä»»ä½•å…³äº[N]è¿‡å»å°±è¯»å­¦æ ¡çš„è®°å½•æˆ–æŠ¥å‘Š', explanation: '' },
            { id: 201, category: '2. ç›®å‰å°±è¯»çš„å­¦æ ¡', type: 'textarea', text: 'ç›®å‰,ä½ å¯¹[N]æ˜¯å¦æœ‰æ‹…å¿§?æ‹…å¿§ä»€ä¹ˆ?', explanation: 'è¯·å°½å¯èƒ½è¯¦ç»†åœ°æè¿°è¿™ä¸ªå­©å­åŠä½ è§‚å¯Ÿåˆ°çš„ä»»ä½•é—®é¢˜ã€‚' },
            { id: 202, category: '2. ç›®å‰å°±è¯»çš„å­¦æ ¡', type: 'textarea', text: 'è¿™äº›é—®é¢˜åœ¨å­¦æ ¡é¦–æ¬¡å¼•èµ·æ³¨æ„æ˜¯ä»€ä¹ˆæ—¶å€™?', explanation: 'è¿™äº›é—®é¢˜å¦‚ä½•éšç€æ—¶é—´è€Œæ”¹å˜ï¼Ÿ' },
            { id: 301, category: '3. è¨€è¯­ã€è¯­è¨€å’Œæ²Ÿé€š', type: 'textarea', text: '[N] åœ¨å­¦æ ¡è¯´è¯çš„ç¨‹åº¦å¦‚ä½•?', explanation: 'å­©å­å’Œä»»ä½•äººè¯´è¯å—?ä»¥ä»€ä¹ˆæ–¹å¼?åœ¨ä»€ä¹ˆæ ·çš„æƒ…æ™¯ä¸‹?\nå­©å­ä¸æ•™èŒå‘˜å·¥å’Œå…¶ä»–å­©å­æ˜¯å¦èƒ½é€‚å½“åœ°è¯´è¯?è¯·è¯¦ç»†æè¿°ã€‚' },
            { id: 302, category: '3. è¨€è¯­ã€è¯­è¨€å’Œæ²Ÿé€š', type: 'textarea', text: 'å¦‚æœ[N]å¯¹ä»»ä½•äººè¯´è¯,ä»–çš„è¨€è¯­å’Œè¯­è¨€ä¸­æ˜¯å¦æœ‰å›°éš¾æˆ–ä¸æˆç†Ÿçš„è¿¹è±¡?', explanation: '' },
            { id: 303, category: '3. è¨€è¯­ã€è¯­è¨€å’Œæ²Ÿé€š', type: 'textarea', text: 'å½“ä¸è¯´è¯ä½†éœ€è¦è¯´äº›ä»€ä¹ˆçš„æ—¶å€™,[N]æ˜¯å¦‚ä½•æ²Ÿé€šçš„?', explanation: 'ä¾‹å¦‚: ç”¨æ‰‹åŠ¿?çœ¼ç¥?è§¦ç¢°?ä¹¦å†™?' },
            { id: 304, category: '3. è¨€è¯­ã€è¯­è¨€å’Œæ²Ÿé€š', type: 'textarea', text: 'åœ¨è¯¾å ‚ä¸Š,[N]çœ‹èµ·æ¥åœ¨å¬è¯¾å—?æœ‰çœ¼ç¥äº¤æµå—?', explanation: '' },
            { id: 305, category: '3. è¨€è¯­ã€è¯­è¨€å’Œæ²Ÿé€š', type: 'textarea', text: 'å¦‚æœ[N]æƒ³è¦ä»€ä¹ˆ,ä¼šå¦‚ä½•å¾—åˆ°å®ƒ?', explanation: 'ä¾‹å¦‚: æŒ‡ç‚¹ã€ä¸¾æ‰‹ã€è§¦ç¢°è€å¸ˆã€å±•ç¤ºä½œä¸šã€è®©å¦ä¸€ä¸ªå­©å­ä¼ è¾¾ä»–çš„éœ€æ±‚;ç­‰å¾…è¢«æ³¨æ„åˆ°;å‘å‡ºå£°å“;é€šè¿‡çˆ¶æ¯ä¼ é€’æ¶ˆæ¯?' },
            { id: 306, category: '3. è¨€è¯­ã€è¯­è¨€å’Œæ²Ÿé€š', type: 'textarea', text: 'å½“[N]éœ€è¦è¯´è¯(ä¾‹å¦‚è¦æ±‚æ‹¼å†™ã€æŠ¥å‘Šç–¾ç—…æˆ–æŠ¥å‘Šè¢«å˜²ç¬‘)æ—¶,ä½ ä¼šåšä»€ä¹ˆ?', explanation: '' },
            { id: 307, category: '3. è¨€è¯­ã€è¯­è¨€å’Œæ²Ÿé€š', type: 'textarea', text: 'å›åº”ç‚¹åçš„æƒ…å†µå¦‚ä½•?ä¸å…¶ä»–å­©å­ç›¸æ¯”,[N]å›åº”ç‚¹åæƒ…å†µæ€ä¹ˆæ ·?', explanation: '' },
            { id: 308, category: '3. è¨€è¯­ã€è¯­è¨€å’Œæ²Ÿé€š', type: 'textarea', text: 'ä½ å¦‚ä½•è¯„ä¼°[N]çš„é˜…è¯»èƒ½åŠ›?', explanation: '' },
            { id: 309, category: '3. è¨€è¯­ã€è¯­è¨€å’Œæ²Ÿé€š', type: 'textarea', text: 'åœ¨è¯¾å ‚å›´åæ—¶é—´,æƒ…å†µæ˜¯æ€æ ·çš„?', explanation: '' },
            { id: 310, category: '3. è¨€è¯­ã€è¯­è¨€å’Œæ²Ÿé€š', type: 'textarea', text: 'å­©å­å¦‚å•æƒ…å†µå¦‚ä½•?', explanation: 'éœ€è¦ä¸Šå•æ‰€æ—¶,ä»–å¦‚ä½•è¡¨è¾¾?ä»–éœ€è¦å¸®åŠ©å—? [N]æœ‰ä»»ä½•å¤±ç¦çš„æƒ…å†µå‘ç”Ÿå—?å°ä¾¿è¿˜æ˜¯å¤§ä¾¿å¤±ç¦?' },
            { id: 311, category: '3. è¨€è¯­ã€è¯­è¨€å’Œæ²Ÿé€š', type: 'textarea', text: '[N] æ˜¯å¦ä¼šä¸»åŠ¨è¿›è¡Œä¸€èˆ¬æ€§æ²Ÿé€š,ä¾‹å¦‚æé—®ã€å‘è¡¨è¯„è®ºã€å¯»æ±‚å¸®åŠ©æˆ–æŠ¥å‘Šç–¾ç—…?', explanation: '' },
            { id: 312, category: '3. è¨€è¯­ã€è¯­è¨€å’Œæ²Ÿé€š', type: 'textarea', text: 'ä½ ä¸ºæ”¹å–„[N]çš„æ²Ÿé€šåšäº†æ€æ ·çš„å°è¯•?', explanation: '' },
            { id: 313, category: '3. è¨€è¯­ã€è¯­è¨€å’Œæ²Ÿé€š', type: 'textarea', text: '[N]åœ¨æœ¬å­¦å¹´çš„æ²Ÿé€šæƒ…å†µæœ‰æ²¡æœ‰å˜åŒ–?', explanation: '' },
            { id: 401, category: '4. ç¤¾äº¤äº’åŠ¨ã€æ°”è´¨å’Œè¡Œä¸º', type: 'textarea', text: 'ä½ ä¼šæ€ä¹ˆå½¢å®¹[N]?', explanation: 'è¯·è¯„è®ºå­©å­çš„æ°”è´¨å’Œè¡Œä¸º,æ˜¯å¿«ä¹ã€ç„¦è™‘ã€çˆ±å‘å·æ–½ä»¤ã€å®³ç¾,è¿˜æ˜¯å…¶ä»–?' },
            { id: 402, category: '4. ç¤¾äº¤äº’åŠ¨ã€æ°”è´¨å’Œè¡Œä¸º', type: 'textarea', text: '[N]æœ‰ä»»ä½•ç‰¹åˆ«çš„ææƒ§ã€ç—´è¿·çš„äº‹ç‰©æˆ–ä¹ æƒ¯å—?', explanation: '' },
            { id: 403, category: '4. ç¤¾äº¤äº’åŠ¨ã€æ°”è´¨å’Œè¡Œä¸º', type: 'textarea', text: 'ä½ è®¤ä¸º[N] æ›¾è¢«æˆå¼„æˆ–æ¬ºè´Ÿè¿‡å—?[N]æ€ä¹ˆè®©ä½ çŸ¥é“çš„?', explanation: '' },
            { id: 404, category: '4. ç¤¾äº¤äº’åŠ¨ã€æ°”è´¨å’Œè¡Œä¸º', type: 'textarea', text: '[N] å’Œè°æ‰“æˆä¸€ç‰‡æˆ–ååœ¨ä¸€èµ·?', explanation: 'æœ‰æ²¡æœ‰æœ€å¥½çš„æœ‹å‹?æ˜¯ç”·ç”Ÿè¿˜æ˜¯å¥³ç”Ÿ?åœ¨ä¸åŒçš„æƒ…å¢ƒä¸‹æœ‰ä¸åŒçš„ç©ä¼´,è¿˜æ˜¯åªæœ‰åŒä¸€ç¾¤ç©ä¼´?' },
            { id: 405, category: '4. ç¤¾äº¤äº’åŠ¨ã€æ°”è´¨å’Œè¡Œä¸º', type: 'textarea', text: '[N] æ˜¯ä¼šå’Œå…¶ä»–å°æœ‹å‹ä¸€èµ·ç©,è¿˜æ˜¯çœ‹ç€ä»–ä»¬ç©?åœ¨å“ªäº›æƒ…å¢ƒä¸‹[N]ä¼šå’Œåˆ«äººä¸€èµ·ç©?', explanation: 'è¯·è¯„è®ºå­©å­åœ¨åˆé¤/è¯¾é—´ä¼‘æ¯æ—¶çš„è‡ªç”±æ´»åŠ¨æƒ…å†µã€åœ¨æœ‰ç»„ç»‡çš„æ´»åŠ¨ä¸­çš„è¡¨ç°,ä»¥åŠåœ¨æ ¡å¤–å’Œæœ‹å‹ç©çš„æƒ…å†µ(å¦‚æœä½ çŸ¥é“)ã€‚' },
            { id: 406, category: '4. ç¤¾äº¤äº’åŠ¨ã€æ°”è´¨å’Œè¡Œä¸º', type: 'textarea', text: '[N]ä¸ä½ ä»¥åŠå…¶ä»–è€å¸ˆå’Œæˆäººç›¸å¤„å¾—å¦‚ä½•?', explanation: 'æ˜¯å¦ç›¸å¤„çš„æ–¹å¼éƒ½ç›¸åŒ?æ˜¯å¦æœ‰æœ€å–œæ¬¢çš„æ–¹å¼?' },
            { id: 501, category: '5. èƒ½åŠ›ã€è¡¨ç°å’Œå…´è¶£', type: 'rating-scale', text: 'è¯·åœ¨ä¸‹é¢çš„å›¾è¡¨ä¸Šå‹¾å‡ºä½ å¯¹[N]èƒ½åŠ›çš„çœ‹æ³•ã€‚', scales: [{ key: 'generalAbility', label: 'ä¸€èˆ¬èƒ½åŠ›' }, { key: 'achievement', label: 'æˆå°±è¡¨ç°' }], options: [{ value: 1, text: 'éå¸¸ä½' },{ value: 2, text: 'ä½äºå¹³å‡' },{ value: 3, text: 'å¹³å‡' },{ value: 4, text: 'ä¼˜äºå¹³å‡' },{ value: 5, text: 'éå¸¸å¥½' }], explanation: '' },
            { id: 502, category: '5. èƒ½åŠ›ã€è¡¨ç°å’Œå…´è¶£', type: 'textarea', text: 'å¦‚æœå¯ä»¥çš„è¯,è¯·æä¾›ä»»ä½•é˜…è¯»å’Œæ‹¼å†™æµ‹è¯•çš„è¯¦ç»†ä¿¡æ¯åŠæˆç»©ã€‚', explanation: '' },
            { id: 503, category: '5. èƒ½åŠ›ã€è¡¨ç°å’Œå…´è¶£', type: 'textarea', text: 'è¯·å°±[N]åœ¨å„ä¸ªå­¦ç§‘é¢†åŸŸçš„è¡¨ç°åšå‡ºè¯„è®º,æŒ‡å‡ºå…¶å¼ºé¡¹å’Œå¼±é¡¹ã€ç‰¹æ®Šæ‰èƒ½å’Œå…´è¶£,ä»¥åŠå¯¹å­¦ä¹ çš„æ€»ä½“æ€åº¦ã€‚', explanation: '' },
            { id: 504, category: '5. èƒ½åŠ›ã€è¡¨ç°å’Œå…´è¶£', type: 'textarea', text: '[N]å‚åŠ ä»»ä½•ä¿±ä¹éƒ¨æˆ–è¯¾å¤–æ´»åŠ¨å—?', explanation: '' },
            { id: 601, category: '6. é¢å¤–çš„è¯„ä¼°å’ŒååŠ©', type: 'textarea', text: 'å­¦æ ¡çš„ç‰¹æ®Šæ•™è‚²éœ€æ±‚åè°ƒå‘˜åœ¨å¤šå¤§ç¨‹åº¦ä¸Šå‚ä¸äº†[N] åœ¨å­¦æ ¡çš„æ•™è‚²å·¥ä½œ?', explanation: '' },
            { id: 602, category: '6. é¢å¤–çš„è¯„ä¼°å’ŒååŠ©', type: 'textarea', text: '[N]çš„ç‰¹æ®Šæ•™è‚²éœ€æ±‚æ˜¯å¦ç»è¿‡æ­£å¼é‰´å®š?', explanation: 'æ­£å¼çš„æ•™è‚²è®¡åˆ’æ˜¯ä»€ä¹ˆ?ç›®å‰çš„ç›®æ ‡æ˜¯ä»€ä¹ˆ?' },
            { id: 603, category: '6. é¢å¤–çš„è¯„ä¼°å’ŒååŠ©', type: 'textarea', text: 'å¦‚æœæ²¡æœ‰æ­£å¼çš„æ•™è‚²ç›®æ ‡,ä½ è§‰å¾—å“ªäº›ç›®æ ‡é€‚åˆ[N]?', explanation: '' },
            { id: 604, category: '6. é¢å¤–çš„è¯„ä¼°å’ŒååŠ©', type: 'textarea', text: '[N]åœ¨è¯»å†™ã€è¯­è¨€ã€å­¦ä¹ æˆ–æ ¡å†…å¤–è¡Œä¸ºæ–¹é¢æ˜¯å¦å¾—åˆ°è¿‡ä»»ä½•é¢å¤–çš„å¸®åŠ©?', explanation: '' },
            { id: 605, category: '6. é¢å¤–çš„è¯„ä¼°å’ŒååŠ©', type: 'textarea', text: 'æ•™è‚²å¿ƒç†å­¦å®¶æ˜¯å¦çŸ¥é“ä½ çš„æ‹…å¿§?', explanation: 'è¯·æè¿°æ•™è‚²å¿ƒç†å­¦å®¶çš„å‚ä¸æƒ…å†µã€‚' },
            { id: 606, category: '6. é¢å¤–çš„è¯„ä¼°å’ŒååŠ©', type: 'textarea', text: '[N]è¿›è¡Œè¿‡å¿ƒç†æµ‹è¯•å—?', explanation: 'å¦‚æœæœ‰,è¯·æä¾›è¯¦ç»†èµ„æ–™æˆ–é™„ä¸ŠæŠ¥å‘Šã€‚' },
            { id: 607, category: '6. é¢å¤–çš„è¯„ä¼°å’ŒååŠ©', type: 'textarea', text: '[N] åœ¨æ ¡å¤–æ˜¯å¦è¿˜æ¥å—è¿‡å…¶ä»–è¯„ä¼°,ä¾‹å¦‚è¨€è¯­å’Œè¯­è¨€è¯„ä¼°æˆ–ä¸“ä¸šæ²»ç–—?', explanation: 'å¦‚æœæœ‰,è¯·æä¾›è¯¦ç»†èµ„æ–™æˆ–é™„ä¸ŠæŠ¥å‘Šã€‚' },
            { id: 701, category: '7. å…„å¼Ÿå§å¦¹çŠ¶å†µ', type: 'textarea', text: '[N] æœ‰æ²¡æœ‰å…„å¼Ÿå§å¦¹åœ¨å­¦æ ¡å°±è¯»?ä»–ä»¬åœ¨å­¦æ ¡çš„è¡¨ç°å¦‚ä½•?', explanation: 'ä»–ä»¬ä¸­çš„ä»»ä½•äººæœ‰ç‰¹æ®Šéœ€æ±‚å—?å…„å¼Ÿå§å¦¹å¦‚ä½•ä¸[N]äº’åŠ¨æˆ–æ”¯æŒ[N]? (è¯·è¯¦ç»†è¯´æ˜ã€‚)' },
            { id: 801, category: '8. å®¶é•¿', type: 'textarea', text: 'å­¦æ ¡å‘˜å·¥å’Œ[N]çš„çˆ¶æ¯å¯¹[N]æœ‰ä¸€æ ·çš„æ‹…å¿§å—?', explanation: 'è¯·æ¦‚è¿°ä½ ä¸å­©å­çš„çˆ¶æ¯çš„è®¨è®ºæƒ…å†µã€‚' },
            { id: 901, category: '9. æ•™èŒå‘˜å·¥åŸ¹è®­å’Œç»éªŒ', type: 'textarea', text: 'ä½ å’Œå…¶ä»–ä¸»è¦å·¥ä½œäººå‘˜å¯¹æ²‰é»˜æˆ–ä¸æ„¿è¯´è¯çš„å­©å­æœ‰ä»€ä¹ˆç›¸å…³çš„ç»éªŒ,æˆ–å—è¿‡ä»€ä¹ˆæ ·çš„åŸ¹è®­?', explanation: '' },
            { id: 902, category: '9. æ•™èŒå‘˜å·¥åŸ¹è®­å’Œç»éªŒ', type: 'textarea', text: 'ä½ è§‰å¾—æˆ‘ä»¬æ€æ ·åšèƒ½å¤Ÿæ”¯æŒä½ ?', explanation: 'éå¸¸æ„Ÿè°¢ä½ å¡«å†™è¿™ä»½è¡¨æ ¼!' }
        ];

        // --- 3. Core Functions ---
        function replaceN(text) {
            const childName = reportInfo.childName || '[N]';
            return text.replace(/\[N\]/g, `<strong style="color: var(--accent-color);">${childName}</strong>`);
        }

        function renderQuestion(index) {
            questionCard.innerHTML = '';
            const question = questions[index];
            const qCard = document.createElement('div');
            qCard.className = 'question-card fade-in';

            qCard.innerHTML = `
                <div class="question-header">
                    <div class="question-category">${question.category}</div>
                    <div class="question-number">é—®é¢˜ ${index + 1}/${questions.length}</div>
                </div>
                <div class="question-text">${replaceN(question.text)}</div>
            `;

            const qContent = document.createElement('div');
            qContent.className = 'question-content';
            const optionsContainer = document.createElement('div');
            optionsContainer.className = 'options-container';

            if (question.type === 'textarea') {
                const textarea = document.createElement('textarea');
                textarea.className = 'form-group textarea-input';
                textarea.id = `q-${question.id}`;
                textarea.placeholder = 'è¯·åœ¨æ­¤è¾“å…¥æ‚¨çš„å›ç­”...';
                textarea.value = userAnswers[question.id] || '';
                optionsContainer.appendChild(textarea);
            } else if (question.type === 'rating-scale') {
                const answer = userAnswers[question.id] || {};
                question.scales.forEach(scale => {
                    const scaleDiv = document.createElement('div');
                    scaleDiv.className = 'rating-scale';
                    let optionsHTML = '';
                    question.options.forEach(opt => {
                        const isChecked = answer[scale.key] === opt.value;
                        optionsHTML += `<label class="rating-option"><span>${opt.text}</span><input type="radio" name="q-${question.id}-${scale.key}" value="${opt.value}" ${isChecked ? 'checked' : ''}></label>`;
                    });
                    scaleDiv.innerHTML = `<span class="rating-scale-label">${scale.label}</span><div class="rating-options">${optionsHTML}</div>`;
                    optionsContainer.appendChild(scaleDiv);
                });
            }

            qContent.appendChild(optionsContainer);

            if (question.explanation) {
                const explanationDiv = document.createElement('div');
                explanationDiv.className = 'question-explanation';
                explanationDiv.innerHTML = `<div class="explanation-title"><i class="fa fa-lightbulb-o"></i> æç¤ºå†…å®¹</div><p style="white-space: pre-wrap;">${question.explanation}</p>`;
                qContent.appendChild(explanationDiv);
            }
            
            qCard.appendChild(qContent);
            questionCard.appendChild(qCard);
            
            prevBtn.disabled = index === 0;
            nextBtn.innerHTML = index === questions.length - 1 ? 'å®Œæˆå¹¶æŸ¥çœ‹æ‘˜è¦ <i class="fa fa-check"></i>' : 'ä¸‹ä¸€é¢˜ <i class="fa fa-arrow-right"></i>';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function saveAnswer(index) {
            const question = questions[index];
            if (!question) return;

            if (question.type === 'textarea') {
                userAnswers[question.id] = document.getElementById(`q-${question.id}`).value;
            } else if (question.type === 'rating-scale') {
                const answer = userAnswers[question.id] || {};
                question.scales.forEach(scale => {
                    const selected = document.querySelector(`input[name="q-${question.id}-${scale.key}"]:checked`);
                    if (selected) {
                        answer[scale.key] = parseInt(selected.value);
                    }
                });
                userAnswers[question.id] = answer;
            }
        }

        function displaySummary() {
            const summaryInfo = document.getElementById('summary-info');
            const summaryContent = document.getElementById('summary-content');
            
            summaryInfo.innerHTML = `
                <div class="summary-item">
                    <h2 class="section-title"><i class="fa fa-file-text-o"></i> æŠ¥å‘ŠåŸºç¡€ä¿¡æ¯</h2>
                    <div class="info-form-grid">
                        <div><strong>å§“å:</strong> ${reportInfo.childName}</div>
                        <div><strong>å‡ºç”Ÿæ—¥æœŸ:</strong> ${reportInfo.dob}</div>
                        <div><strong>å­¦æ ¡:</strong> ${reportInfo.schoolName}</div>
                        <div><strong>å…¥å­¦æ—¥æœŸ:</strong> ${reportInfo.admissionDate}</div>
                        <div style="grid-column: 1 / -1;"><strong>åœ°å€:</strong> ${reportInfo.address}</div>
                        <hr style="grid-column: 1 / -1; border: 0; border-top: 1px solid #ddd; margin: 10px 0;">
                        <div><strong>å®¶é•¿æ‰‹æœº:</strong> ${reportInfo.parentPhone || 'æœªå¡«å†™'}</div>
                        <div><strong>å®¶é•¿å¾®ä¿¡:</strong> ${reportInfo.parentWechat || 'æœªå¡«å†™'}</div>
                        <div><strong>å®¶é•¿é‚®ç®±:</strong> ${reportInfo.parentEmail || 'æœªå¡«å†™'}</div>
                        <hr style="grid-column: 1 / -1; border: 0; border-top: 1px solid #ddd; margin: 10px 0;">
                        <div><strong>å¡«è¡¨äºº:</strong> ${reportInfo.fillerName}</div>
                        <div><strong>å¡«è¡¨æ—¥æœŸ:</strong> ${reportInfo.fillDate}</div>
                    </div>
                </div>`;
            
            summaryContent.innerHTML = '';
            questions.forEach(q => {
                const item = document.createElement('div');
                item.className = 'summary-item';
                let answerHTML = '<div class="summary-answer"><i>æœªä½œç­”</i></div>';
                const answer = userAnswers[q.id];

                if (answer && Object.keys(answer).length > 0) {
                    if (q.type === 'textarea') {
                        answerHTML = `<div class="summary-answer">${answer || '<i>æœªä½œç­”</i>'}</div>`;
                    } else if (q.type === 'rating-scale') {
                        let scaleAnswers = '';
                        const getOptText = val => (q.options.find(opt => opt.value === val) || {}).text || 'N/A';
                        q.scales.forEach(scale => {
                            scaleAnswers += `<strong>${scale.label}:</strong> ${getOptText(answer[scale.key])}<br>`;
                        });
                        answerHTML = `<div class="summary-answer">${scaleAnswers || '<i>æœªä½œç­”</i>'}</div>`;
                    }
                }
                item.innerHTML = `<div class="summary-question">${q.category} - ${replaceN(q.text)}</div>${answerHTML}`;
                summaryContent.appendChild(item);
            });

            questionsContainer.style.display = 'none';
            summaryContainer.style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- 4. Event Listeners ---
        document.getElementById('info-form').addEventListener('input', () => {
            const inputs = document.querySelectorAll('#info-form input[required]');
            startBtn.disabled = ![...inputs].every(input => input.value);
        });

        startBtn.addEventListener('click', () => {
            reportInfo = {
                childName: document.getElementById('childName').value,
                dob: document.getElementById('dob').value,
                gender: document.getElementById('gender').value,
                gradeLevel: document.getElementById('gradeLevel').value,
                schoolName: document.getElementById('schoolName').value,
                admissionDate: document.getElementById('admissionDate').value,
                address: document.getElementById('address').value,
                parentPhone: document.getElementById('parentPhone').value,
                parentWechat: document.getElementById('parentWechat').value,
                parentEmail: document.getElementById('parentEmail').value,
                fillerName: document.getElementById('fillerName').value,
                fillDate: document.getElementById('fillDate').value,
            };
            welcomePage.style.display = 'none';
            questionsContainer.style.display = 'block';
            renderQuestion(0);
        });

        prevBtn.addEventListener('click', () => {
            saveAnswer(currentQuestionIndex);
            currentQuestionIndex--;
            renderQuestion(currentQuestionIndex);
        });

        nextBtn.addEventListener('click', () => {
            saveAnswer(currentQuestionIndex);
            if (currentQuestionIndex === questions.length - 1) {
                displaySummary();
            } else {
                currentQuestionIndex++;
                renderQuestion(currentQuestionIndex);
            }
        });
        
        restartBtn.addEventListener('click', () => {
            currentQuestionIndex = 0;
            Object.keys(userAnswers).forEach(key => delete userAnswers[key]);
            document.querySelectorAll('#info-form input, #info-form select').forEach(input => {
                if (input.id === 'fillDate') {
                    input.valueAsDate = new Date();
                } else {
                    input.value = '';
                }
            });
            // é‡ç½®æ€§åˆ«é€‰æ‹©æ¡†
            const genderField = document.getElementById('gender');
            if (genderField) {
                genderField.selectedIndex = 0;
            }
            startBtn.disabled = true;
            summaryContainer.style.display = 'none';
            welcomePage.style.display = 'block';
        });
        
        // Initialize
        document.getElementById('fillDate').valueAsDate = new Date();
        
        // è¯»å–localStorageä¸­ä¿å­˜çš„åŸºæœ¬ä¿¡æ¯
        const savedInfo = localStorage.getItem('basicInfo');
        if (savedInfo) {
            const info = JSON.parse(savedInfo);
            
            // å¡«å……å§“åå­—æ®µ
            const nameField = document.getElementById('childName');
            if (nameField && info.name) {
                nameField.value = info.name;
            }
            
            // å¡«å……å‡ºç”Ÿæ—¥æœŸå­—æ®µ
            const birthdateField = document.getElementById('dob');
            if (birthdateField && info.birthdate) {
                birthdateField.value = info.birthdate;
            }
            
            // å¡«å……æ€§åˆ«å­—æ®µ
            const genderField = document.getElementById('gender');
            if (genderField && info.gender) {
                genderField.value = info.gender;
            }
            
            // å¡«å……å¹´çº§å­—æ®µ
            const gradeLevelField = document.getElementById('gradeLevel');
            if (gradeLevelField && info.gradeLevel) {
                gradeLevelField.value = info.gradeLevel;
            }
        }

        // æ·»åŠ ä¿å­˜ç»“æœåŠŸèƒ½
        document.getElementById('save-result-btn').addEventListener('click', async function() {
            try {
                // éªŒè¯åŸºæœ¬ä¿¡æ¯
                const validationErrors = [];
                if (!reportInfo.childName || !reportInfo.childName.trim()) {
                    validationErrors.push('è¯·å¡«å†™å„¿ç«¥å§“å');
                }
                if (!reportInfo.dob) {
                    validationErrors.push('è¯·é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ');
                }
                if (!reportInfo.fillDate) {
                    validationErrors.push('è¯·é€‰æ‹©å¡«è¡¨æ—¥æœŸ');
                }

                if (validationErrors.length > 0) {
                    alert('âŒ è¯·å®Œå–„ä»¥ä¸‹ä¿¡æ¯ï¼š\n' + validationErrors.join('\n'));
                    return;
                }

                // æ„å»ºç¬¦åˆAPIæ ‡å‡†çš„é—®é¢˜æ•°æ®
                const questions = [];
                let questionIndex = 1;
                
                Object.entries(userAnswers).forEach(([questionId, answer]) => {
                    // æŸ¥æ‰¾å¯¹åº”çš„é—®é¢˜æ–‡æœ¬
                    const question = questions.find(q => q.id === questionId);
                    const questionText = question ? question.text : questionId;
                    
                    if (typeof answer === 'string' && answer.trim()) {
                        // æ–‡æœ¬è¾“å…¥é¢˜
                        questions.push({
                            id: questionIndex++,
                            type: 'text_input',
                            question: questionText,
                            answer: answer.trim()
                        });
                    } else if (typeof answer === 'object' && answer !== null) {
                        // è¯„åˆ†é¢˜ - ä¿æŒrating-scaleç±»å‹
                        const ratings = Object.entries(answer).filter(([key, value]) => value !== undefined);
                        if (ratings.length > 0) {
                            ratings.forEach(([subQuestion, rating]) => {
                                questions.push({
                                    id: questionIndex++,
                                    type: 'rating_scale',
                                    question: `${questionText} - ${subQuestion}`,
                                    rating: rating,
                                    max_rating: 5,
                                    min_rating: 1,
                                    scale_labels: ['éå¸¸ä½', 'ä½äºå¹³å‡', 'å¹³å‡', 'ä¼˜äºå¹³å‡', 'éå¸¸å¥½']
                                });
                            });
                        }
                    }
                });

                // æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„ç­”æ¡ˆ
                if (questions.length < 3) {
                    alert('âŒ è¯·è‡³å°‘å›ç­”3ä¸ªé—®é¢˜åå†æäº¤');
                    return;
                }

                // æ„å»ºç¬¦åˆAPIæ ‡å‡†çš„å®Œæ•´æ•°æ®å¯¹è±¡
                const dataToSubmit = {
                    type: 'å°å­¦ç”ŸæŠ¥å‘Š',
                    basic_info: {
                        name: reportInfo.childName.trim(),
                        grade: reportInfo.gradeLevel || 'æœªå¡«å†™',
                        submission_date: reportInfo.fillDate,
                        gender: reportInfo.gender || '',
                        birth_date: reportInfo.dob || '',
                        parent_phone: reportInfo.parentPhone || '',
                        parent_wechat: reportInfo.parentWechat || '',
                        parent_email: reportInfo.parentEmail || '',
                        school_name: reportInfo.schoolName || '',
                        admission_date: reportInfo.admissionDate || '',
                        address: reportInfo.address || '',
                        filler_name: reportInfo.fillerName || '',
                        fill_date: reportInfo.fillDate || ''
                    },
                    questions: questions,
                    statistics: {
                        total_score: questions.length,
                        completion_rate: 100,
                        submission_time: new Date().toISOString()
                    }
                };

                // å‘é€POSTè¯·æ±‚åˆ°åç«¯API
                const response = await fetch(CONFIG.getApiUrl(CONFIG.API.SUBMIT), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(dataToSubmit),
                    mode: 'cors',
                    credentials: 'include'
                });

                // å¤„ç†å“åº”
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        alert('âœ… æ•°æ®ä¿å­˜æˆåŠŸï¼\né—®å·ID: ' + (result.id || result.record_id));
                        showCompletion(result.id || result.record_id);
                    } else {
                        let errorMessage = result.error?.message || 'ä¿å­˜å¤±è´¥';
                        if (result.error?.details && Array.isArray(result.error.details)) {
                            errorMessage = 'æ•°æ®éªŒè¯å¤±è´¥ï¼š\n' + result.error.details.join('\n');
                        }
                        alert('âŒ ä¿å­˜å¤±è´¥ï¼š\n' + errorMessage);
                    }
                } else {
                    let errorMessage = `æœåŠ¡å™¨é”™è¯¯ (${response.status})`;
                    try {
                        const errorData = await response.json();
                        if (errorData.error) {
                            if (errorData.error.details && Array.isArray(errorData.error.details)) {
                                errorMessage = 'æ•°æ®éªŒè¯å¤±è´¥ï¼š\n' + errorData.error.details.join('\n');
                            } else {
                                errorMessage = errorData.error.message || errorData.message || errorMessage;
                            }
                        }
                    } catch (e) {
                        errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                    }
                    alert(`âŒ æ•°æ®ä¿å­˜å¤±è´¥:\n${errorMessage}`);
                }
            } catch (error) {
                console.error('æäº¤æ•°æ®æ—¶å‡ºé”™:', error);
                let errorMessage = 'ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹æƒ…å†µï¼š\n\n';
                
                if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    errorMessage += 'âŒ ç½‘ç»œè¿æ¥é—®é¢˜ï¼š\n';
                    errorMessage += '  â€¢ ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆè¿è¡Œ python app.pyï¼‰\n';
                    errorMessage += '  â€¢ æ£€æŸ¥æœåŠ¡å™¨åœ°å€æ˜¯å¦æ­£ç¡® (127.0.0.1:5000)\n';
                    errorMessage += '  â€¢ æ£€æŸ¥é˜²ç«å¢™è®¾ç½®\n\n';
                } else if (error.message.includes('CORS')) {
                    errorMessage += 'âŒ CORSé…ç½®é—®é¢˜ï¼š\n';
                    errorMessage += '  â€¢ åç«¯æœåŠ¡å™¨CORSé…ç½®å¯èƒ½æœ‰é—®é¢˜\n';
                    errorMessage += '  â€¢ è¯·è”ç³»æŠ€æœ¯æ”¯æŒ\n\n';
                } else {
                    errorMessage += `âŒ å…¶ä»–é”™è¯¯ï¼š${error.message}\n\n`;
                }
                
                errorMessage += 'ğŸ’¡ å»ºè®®ï¼š\n';
                errorMessage += '  â€¢ åˆ·æ–°é¡µé¢é‡è¯•\n';
                errorMessage += '  â€¢ æ£€æŸ¥ç½‘ç»œè¿æ¥\n';
                errorMessage += '  â€¢ è”ç³»æŠ€æœ¯æ”¯æŒ';
                
                alert(errorMessage);
            }
        });
        
        /**
         * æ˜¾ç¤ºå®Œæˆé¡µé¢
         */
        function showCompletion(recordId) {
            // éšè—é—®å·åŒºåŸŸ
            document.querySelector('.container').style.display = 'none';
            
            // åˆ›å»ºå®Œæˆé¡µé¢
            const completionPage = document.createElement('div');
            completionPage.className = 'completion-page';
            completionPage.innerHTML = `
                <div class="completion-container">
                    <div class="completion-header">
                        <h1><i class="fa fa-check-circle"></i> æŠ¥å‘Šå®Œæˆ</h1>
                        <p class="completion-subtitle">å°å­¦ç”ŸæŠ¥å‘Šè¡¨å·²æˆåŠŸä¿å­˜</p>
                    </div>
                    
                    <div class="completion-info">
                        <div class="info-card">
                            <h3><i class="fa fa-info-circle"></i> åŸºæœ¬ä¿¡æ¯</h3>
                            <div class="info-grid">
                                <div><strong>å­¦ç”Ÿå§“å:</strong> ${reportInfo.childName}</div>
                                <div><strong>å‡ºç”Ÿæ—¥æœŸ:</strong> ${reportInfo.dob}</div>
                                <div><strong>æ€§åˆ«:</strong> ${reportInfo.gender}</div>
                                <div><strong>å¹´çº§:</strong> ${reportInfo.gradeLevel}</div>
                                <div><strong>å­¦æ ¡:</strong> ${reportInfo.schoolName}</div>
                                <div><strong>å…¥å­¦æ—¥æœŸ:</strong> ${reportInfo.admissionDate}</div>
                                <div><strong>å¡«è¡¨äºº:</strong> ${reportInfo.fillerName}</div>
                                <div><strong>å¡«è¡¨æ—¥æœŸ:</strong> ${reportInfo.fillDate}</div>
                                <div><strong>è®°å½•ID:</strong> ${recordId}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="completion-answers">
                        <h3><i class="fa fa-list-alt"></i> å›ç­”æ€»è§ˆ</h3>
                        ${generateAnswersHTML()}
                    </div>
                    
                    <div class="completion-actions">
                        <button class="btn-primary" onclick="window.location.reload()">
                            <i class="fa fa-refresh"></i> å¡«å†™æ–°æŠ¥å‘Š
                        </button>
                        <button class="btn-secondary" onclick="window.print()">
                            <i class="fa fa-print"></i> æ‰“å°
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(completionPage);
        }
        
        /**
         * ç”Ÿæˆç­”æ¡ˆHTML
         */
        function generateAnswersHTML() {
            let html = '<div class="answers-list">';
            
            questions.forEach((question, index) => {
                const answer = userAnswers[question.id] || {};
                let answerText = 'æœªä½œç­”';
                
                if (question.type === 'textarea' && answer) {
                    answerText = answer;
                } else if (question.type === 'rating-scale' && Object.keys(answer).length > 0) {
                    const getOptText = val => (question.options.find(opt => opt.value === val) || {}).text || 'N/A';
                    let scaleAnswers = '';
                    question.scales.forEach(scale => {
                        scaleAnswers += `<strong>${scale.label}:</strong> ${getOptText(answer[scale.key])}<br>`;
                    });
                    answerText = scaleAnswers;
                }
                
                html += `
                    <div class="answer-item">
                        <div class="answer-question">
                            <strong>${question.category} - ${question.text.replace(/\d+\.\s*/, '')}</strong>
                        </div>
                        <div class="answer-content">${answerText}</div>
                    </div>
                `;
            });
            
            html += '</div>';
            return html;
        }

    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>é­”æ³•è¿çº¿ Â· ç½‘ç»œç‰ˆ | å°å¸ƒå¼€å£</title>
<meta name="description" content="é­”æ³•è¿çº¿ Â· ç½‘ç»œç‰ˆ â€” å°å¸ƒå¼€å£å‡ºå“ã€‚ä½¿ç”¨ç½‘ç»œå›¾ç‰‡çš„å„¿ç«¥é…å¯¹ç›Šæ™ºæ¸¸æˆï¼Œæ”¯æŒæ‰‹æœº/å¹³æ¿/PCï¼Œè‡ªé€‚åº”å¸ƒå±€">

<!-- ç¯å¢ƒé…ç½® -->
<script src="env-config.js"></script>
<style>
  :root{
    --y-1:#FFE370; --y-2:#FFC93A; --y-3:#FFB31A; --o-1:#FF8A3D; --o-2:#FF9B57;
    --r-1:#FF5B6E; --g-1:#6FCF6A; --b-1:#50B7F5; --pink:#FF76A8; --ink:#4A3A2A;
    --muted:#6B5B4B; --white:#FFFFFF; --sticker-border: 4px solid #fff;
    --shadow-1: 0 10px 24px rgba(0,0,0,.12); --shadow-2: 0 14px 32px rgba(0,0,0,.16);
    --shadow-soft: 0 20px 50px rgba(255,179,26,.25); --r-lg: 28px; --r-md: 20px; --r-sm: 14px;
  }
  body{
    margin:0; color:var(--ink); font-family: "Smiley Sans", ui-rounded, system-ui, -apple-system, "Segoe UI", Roboto, "PingFang SC","Hiragino Sans GB","Microsoft YaHei", sans-serif;
    background: radial-gradient(1400px 700px at 100% -10%, rgba(255,255,255,.35), transparent 60%) no-repeat, linear-gradient(180deg, var(--y-1), var(--y-2));
    background-image: radial-gradient(1200px 500px at -10% 0%, rgba(255,255,255,.35), transparent 60%), linear-gradient(180deg, var(--y-1), var(--y-2)), url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" viewBox="0 0 120 120"><g fill="none" stroke="rgba(255,255,255,0.18)" stroke-width="3"><path d="M20 20h40a10 10 0 110 10 10 10 0 100 20h40v40H20z"/><circle cx="95" cy="25" r="8"/><circle cx="25" cy="95" r="8"/></g></svg>');
    background-size: auto, auto, 120px 120px;
  }
  .wrap{max-width:min(1280px, 96vw); margin:0 auto; padding:clamp(10px,2vw,18px)}
  header{
    display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
    background: linear-gradient(180deg, #FFF6D7, #FFE8A8); border: var(--sticker-border); border-radius: var(--r-lg);
    box-shadow: var(--shadow-1), var(--shadow-soft); padding: 10px 12px;
  }
  .brand{ display:flex; gap:12px; align-items:center; }
  .logo{
    width: clamp(52px, 7vw, 72px); height: clamp(52px, 7vw, 72px); flex:0 0 auto; border-radius: 20px;
    background: radial-gradient(circle at 30% 30%, #FFEFB5, #FFD46E 70%); border: var(--sticker-border); box-shadow: var(--shadow-2);
    display:grid; place-items:center;
  }
  .titles h1{ margin:0; font-size:clamp(18px, 2.4vw, 26px); letter-spacing:.5px; font-weight:900; }
  .titles .sub{ font-size:clamp(12px, 1.6vw, 14px); color:var(--muted) }
  .controls{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
  .pill{
    display:inline-flex; align-items:center; gap:8px; border: var(--sticker-border); background:#FFF9E6; color:var(--ink);
    border-radius: 999px; padding:6px 10px; box-shadow: var(--shadow-1);
  }
  select, button{
    appearance:none; border:none; cursor:pointer; border-radius: 16px; padding:10px 14px; font-size:clamp(13px, 1.6vw, 15px); box-shadow: var(--shadow-1);
  }
  select{ background:#FFF3CC; color:var(--ink); border:2px solid rgba(0,0,0,.06) }
  button.primary{ background:linear-gradient(180deg, var(--o-1), var(--o-2)); color:var(--white); font-weight:800; border: var(--sticker-border); }
  button.sub{ background:linear-gradient(180deg, #6FCF6A, #45B34A); color:var(--white); font-weight:800; border: var(--sticker-border); }
  button.ghost{ background:#FFF3CC; color:#8A5A00; border: var(--sticker-border); font-weight:700; }
  button:active{ transform:translateY(1px) }
  .status{
    margin:clamp(8px, 1.5vw, 12px) 0; font-size:clamp(13px, 1.6vw, 15px); color:#8A5A00;
    background:linear-gradient(90deg, rgba(255,255,255,.7), rgba(255,255,255,.45)); border: var(--sticker-border);
    padding:10px 12px; border-radius: 16px; box-shadow: var(--shadow-1);
  }
  .board{
    position:relative; display:grid; grid-template-columns: 1fr 1fr; column-gap: clamp(28px, 10vw, 240px); row-gap: clamp(10px,1.6vw,16px);
    min-height: min(64vh, 720px); padding: clamp(12px, 1.8vw, 20px); border-radius: var(--r-lg);
    background: radial-gradient(90% 60% at 50% 0%, rgba(255,255,255,.9), rgba(255,255,255,.8) 40%, rgba(255,255,255,.7) 100%), linear-gradient(180deg, #FFF6D7, #FFE8A8);
    border: var(--sticker-border); box-shadow: var(--shadow-2), var(--shadow-soft); overflow:hidden;
  }
  .col{ display:grid; gap:clamp(10px, 1.6vw, 14px); align-content:start; grid-auto-rows:minmax(clamp(60px,8.2vw,80px), auto); }
  .card{
    display:flex; align-items:center; gap:10px; width: clamp(150px, 28vw, 240px);
    padding: clamp(10px, 1.7vw, 14px) clamp(12px, 2vw, 16px); border-radius: 20px;
    background: radial-gradient(140% 120% at 20% -20%, #FFFFFF, #FFF3CC 70%); border: var(--sticker-border);
    box-shadow: var(--shadow-1); user-select:none; touch-action:none; transition: all 0.2s ease;
  }
  .card .img-box{
    width: clamp(42px, 8vw, 74px); height: clamp(42px, 8vw, 74px); flex-shrink: 0;
    border-radius: 16px; overflow: hidden; border: 3px solid #fff;
    box-shadow: 0 4px 8px rgba(0,0,0,.15); background: #f8f8f8;
  }
  .card .img-box img{
    width: 100%; height: 100%; object-fit: cover; object-position: center;
  }
  .card .label{ font-size: clamp(13px, 2.1vw, 18px); font-weight:900; letter-spacing:.3px; color:#6B4A00; }
  .card.selecting{ box-shadow:0 16px 26px rgba(255,179,26,.32), inset 0 0 0 4px rgba(255,179,26,.45); transform: scale(1.02); }
  .card.locked{ opacity:.85; box-shadow: inset 0 0 0 4px rgba(111,207,106,.45); filter: grayscale(30%); }
  .card.shake{ animation:shake .25s linear }
  @keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-3px)}50%{transform:translateX(3px)}75%{transform:translateX(-3px)}100%{transform:translateX(0)}}
  .wires{ position:absolute; inset:0; width:100%; height:100%; pointer-events:none; z-index:5 }
  .wire{ stroke-width:8; stroke-linecap:round; filter: drop-shadow(0 2px 3px rgba(0,0,0,.18)); }
  .wire.temp{ stroke-dasharray:10 10; opacity:.95 }
  .wire.good{ stroke: var(--o-1) }
  .wire.bad{ stroke: var(--r-1) }
  .wire.neutral{ stroke: var(--y-3) }
  .actionbar{ display:flex; gap:8px; justify-content:center; margin-top:clamp(8px, 1.4vw, 12px) }
  .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.25); z-index:12; }
  .modal.show{ display:flex }
  .modal-card{
    width:min(92vw, 560px); background: radial-gradient(180px 120px at 10% -10%, rgba(255,179,26,.18), transparent 60%), linear-gradient(180deg, #FFF6D7, #FFE8A8);
    border: var(--sticker-border); border-radius: 22px; padding:22px; box-shadow: var(--shadow-2); text-align:center; color:var(--ink);
  }
  .modal h2{ margin:.3em 0 .2em; font-size:clamp(22px, 3vw, 30px) }
  .modal p{ margin:.2em 0 1em; color:var(--muted) }
  .modal .badge{ display:inline-block; padding:6px 12px; border-radius:999px; background:#FFF; border: var(--sticker-border); margin-bottom:8px; box-shadow: var(--shadow-1)}
  .modal .btns{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap }
  .confetti{ position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:11 }
  .confetti i{ position:absolute; width:10px; height:16px; opacity:.95; top:-20px; transform:translateY(-100px); animation:fall linear forwards }
  @keyframes fall{ to{ transform: translateY(110vh) rotate(720deg) } }
  @media (max-width: 980px){ .board{ column-gap: clamp(20px, 8vw, 120px) } }
  @media (max-width: 720px){ .card{ width: auto } }
  @media (max-width: 480px){
    header{ border-radius: var(--r-md) }
    .board{ border-radius: var(--r-md) }
    .titles h1{ font-size: 18px }
  }
  @media (min-width: 540px) and (max-width: 720px) and (orientation: portrait){ .col{ grid-auto-rows:minmax(72px, auto) } }
  @media (prefers-reduced-motion: reduce){
    *{ animation-duration:.01ms !important; animation-iteration-count:1 !important; transition-duration:.01ms !important; scroll-behavior:auto !important; }
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <svg width="100%" height="100%" viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg">
          <path d="M10 18a16 16 0 0 1 16-16h20a16 16 0 0 1 16 16v10a16 16 0 0 1-16 16h-9l-9 9v-9H26A16 16 0 0 1 10 28Z" fill="#FFE8A8" stroke="#FFFFFF" stroke-width="3" />
          <rect x="36" y="34" width="6" height="24" rx="3" transform="rotate(35 39 46)" fill="#FF8A3D"/>
          <rect x="36" y="30" width="6" height="8" rx="3" transform="rotate(35 39 34)" fill="#FFC93A" />
          <g fill="#FFC93A" stroke="#E08A00" stroke-width=".6">
            <path d="M55 10l2 4 4 .6-3 2.9.8 4.1-3.8-2.1-3.8 2.1.8-4.1-3-2.9 4-.6z"/>
            <path d="M22 8l1.2 2.4 2.6.4-2 1.9.5 2.6-2.3-1.3-2.3 1.3.5-2.6-2-1.9 2.6-.4z" transform="translate(8 6)"/>
          </g>
          <path d="M16 24h20a8 8 0 0 1 0 16H26l-6 6v-6h-4Z" fill="none" stroke="#FF8A3D" stroke-width="3" opacity=".9"/>
        </svg>
      </div>
      <div class="titles">
        <h1>é­”æ³•è¿çº¿ Â· ç½‘ç»œç‰ˆ</h1>
        <div class="sub">å°å¸ƒå¼€å£ | ç½‘ç»œå›¾ç‰‡æ›´ç²¾å½©</div>
      </div>
    </div>

    <div class="controls">
      <span class="pill">éš¾åº¦ï¼š
        <select id="difficulty">
          <option value="4" selected>å…¥é—¨ 4 å¯¹</option>
          <option value="6">ä¸­çº§ 6 å¯¹</option>
          <option value="8">æŒ‘æˆ˜ 8 å¯¹</option>
        </select>
      </span>
      <span class="pill">é¢˜åº“ï¼š
        <select id="deck">
          <option value="main" selected>åŠ¨ç‰©ä¸–ç•Œ</option>
          <option value="animals">åŠ¨ç‰©+é£Ÿç‰©</option>
          <option value="jobs">èŒä¸š+å·¥å…·</option>
        </select>
      </span>
      <button id="newGame" class="primary">æ–°ä¸€å±€</button>
      <button id="giveHint" class="ghost">æç¤º</button>
    </div>
  </header>

  <div id="status" class="status">æ­£åœ¨åŠ è½½ç½‘ç»œå›¾ç‰‡â€¦</div>

  <section id="board" class="board" aria-label="æ¸¸æˆåŒºåŸŸ">
    <div id="leftCol" class="col" aria-label="å·¦è¾¹é€‰é¡¹"></div>
    <div id="rightCol" class="col" aria-label="å³è¾¹é€‰é¡¹"></div>
    <svg id="wires" class="wires" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" preserveAspectRatio="none"></svg>
  </section>

  <div class="actionbar">
    <button id="restart" class="sub">é‡æ¥ä¸€å±€</button>
    <button id="levelUp" class="primary">å‡çº§éš¾åº¦</button>
  </div>
</div>

<div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="modal-card">
    <div class="badge" id="modalBadge">ğŸ‰ èƒœåˆ©</div>
    <h2 id="modalTitle">å®è´ä½ çœŸæ£’ï¼</h2>
    <p id="modalMsg">å…¨éƒ¨é…å¯¹å®Œæˆï¼å†æ¥ä¸€å±€æˆ–å‡çº§éš¾åº¦ç»§ç»­æŒ‘æˆ˜å§ï½</p>
    <div class="btns">
      <button id="modalRestart" class="sub">é‡æ¥ä¸€å±€</button>
      <button id="modalLevelUp" class="primary">å‡çº§éš¾åº¦</button>
    </div>
  </div>
</div>

<script>
/* =========== ç½‘ç»œå›¾ç‰‡æ˜ å°„ç³»ç»Ÿ =========== */
// ä½¿ç”¨å…¨å±€ç¯å¢ƒé…ç½®
const BASE_URL = window.ENV_CONFIG ? window.ENV_CONFIG.baseUrl + '/imgs/' : '/imgs/';
window.ENV_CONFIG && window.ENV_CONFIG.log('Magic-wire initialized', {
    BASE_URL: BASE_URL,
    environment: window.ENV_CONFIG.getEnvDescription()
});

const IMAGE_MAP = {
  // åŠ¨ç‰©æ˜ å°„
  'dog': { left: { img: BASE_URL + 'å°ç‹—.jpg', label: 'å°ç‹—' }, right: { img: BASE_URL + 'éª¨å¤´.jpg', label: 'éª¨å¤´' } },
  'cat': { left: { img: BASE_URL + 'å°çŒ«.jpg', label: 'å°çŒ«' }, right: { img: BASE_URL + 'å°é±¼.jpg', label: 'å°é±¼' } },
  'rabbit': { left: { img: BASE_URL + 'å…”å­.jpg', label: 'å…”å­' }, right: { img: BASE_URL + 'èƒ¡èåœ.jpg', label: 'èƒ¡èåœ' } },
  'panda': { left: { img: BASE_URL + 'ç†ŠçŒ«.jpg', label: 'ç†ŠçŒ«' }, right: { img: BASE_URL + 'ç«¹å­.jpg', label: 'ç«¹å­' } },
  'penguin': { left: { img: BASE_URL + 'ä¼é¹….jpg', label: 'ä¼é¹…' }, right: { img: BASE_URL + 'å†°å—.jpg', label: 'å†°å—' } },
  'elephant': { left: { img: BASE_URL + 'å¤§è±¡.jpg', label: 'å¤§è±¡' }, right: { img: BASE_URL + 'èŠ±ç”Ÿ.jpg', label: 'èŠ±ç”Ÿ' } },
  'monkey': { left: { img: BASE_URL + 'çŒ´å­.jpg', label: 'çŒ´å­' }, right: { img: BASE_URL + 'é¦™è•‰.jpg', label: 'é¦™è•‰' } },
  'squirrel': { left: { img: BASE_URL + 'æ¾é¼ .jpg', label: 'æ¾é¼ ' }, right: { img: BASE_URL + 'æ©¡æœ.jpg', label: 'æ©¡æœ' } },
  'frog': { left: { img: BASE_URL + 'é’è›™.jpg', label: 'é’è›™' }, right: { img: BASE_URL + 'å°é£è™«.jpg', label: 'å°é£è™«' } },
  'croc': { left: { img: BASE_URL + 'é³„é±¼.jpg', label: 'é³„é±¼' }, right: { img: BASE_URL + 'æ²³æµ.jpg', label: 'æ²³æµ' } },
  'dolphin': { left: { img: BASE_URL + 'æµ·è±š.jpg', label: 'æµ·è±š' }, right: { img: BASE_URL + 'æµ·åº•.jpg', label: 'æµ·åº•' } },
  'cow': { left: { img: BASE_URL + 'å¥¶ç‰›.jpg', label: 'å¥¶ç‰›' }, right: { img: BASE_URL + 'ç‰›å¥¶.jpg', label: 'ç‰›å¥¶' } },
  'pig': { left: { img: BASE_URL + 'å°çŒª.jpg', label: 'å°çŒª' }, right: { img: BASE_URL + 'çŒªåœˆ.jpg', label: 'çŒªåœˆ' } },
  'chicken': { left: { img: BASE_URL + 'æ¯é¸¡.jpg', label: 'æ¯é¸¡' }, right: { img: BASE_URL + 'é¸¡è›‹.jpg', label: 'é¸¡è›‹' } },
  'sheep': { left: { img: BASE_URL + 'ç»µç¾Š.jpg', label: 'ç»µç¾Š' }, right: { img: BASE_URL + 'ç¾Šæ¯›.jpg', label: 'ç¾Šæ¯›' } },
  'horse': { left: { img: BASE_URL + 'é©¬.jpg', label: 'é©¬' }, right: { img: BASE_URL + 'é©¬è¹„é“.jpg', label: 'é©¬è¹„é“' } },
  'turtle': { left: { img: BASE_URL + 'ä¹Œé¾Ÿ.jpg', label: 'ä¹Œé¾Ÿ' }, right: { img: BASE_URL + 'æ± å¡˜.jpg', label: 'æ± å¡˜' } },
  'koala': { left: { img: BASE_URL + 'è€ƒæ‹‰.jpg', label: 'è€ƒæ‹‰' }, right: { img: BASE_URL + 'æ¡‰æ ‘å¶.jpg', label: 'æ¡‰æ ‘å¶' } },
  'owl': { left: { img: BASE_URL + 'çŒ«å¤´é¹°.jpg', label: 'çŒ«å¤´é¹°' }, right: { img: BASE_URL + 'ä¹¦æœ¬.jpg', label: 'ä¹¦æœ¬' } },
  'fox': { left: { img: BASE_URL + 'ç‹ç‹¸.jpg', label: 'ç‹ç‹¸' }, right: { img: BASE_URL + 'æ´ç©´.jpg', label: 'æ´ç©´' } },
  'bird': { left: { img: BASE_URL + 'å°é¸Ÿ.jpg', label: 'å°é¸Ÿ' }, right: { img: BASE_URL + 'é¸Ÿå·¢.jpg', label: 'é¸Ÿå·¢' } },
  'bee': { left: { img: BASE_URL + 'èœœèœ‚.jpg', label: 'èœœèœ‚' }, right: { img: BASE_URL + 'èœ‚èœœ.jpg', label: 'èœ‚èœœ' } },
  
  // èŒä¸šæ˜ å°„
  'doctor': { left: { img: BASE_URL + 'åŒ»ç”Ÿ.jpg', label: 'åŒ»ç”Ÿ' }, right: { img: BASE_URL + 'å¬è¯Šå™¨.jpg', label: 'å¬è¯Šå™¨' } },
  'fire': { left: { img: BASE_URL + 'æ¶ˆé˜²å‘˜.jpg', label: 'æ¶ˆé˜²å‘˜' }, right: { img: BASE_URL + 'ç­ç«å™¨.jpg', label: 'ç­ç«å™¨' } },
  'police': { left: { img: BASE_URL + 'è­¦å¯Ÿ.jpg', label: 'è­¦å¯Ÿ' }, right: { img: BASE_URL + 'è­¦è½¦.jpg', label: 'è­¦è½¦' } },
  'teacher': { left: { img: BASE_URL + 'è€å¸ˆ.jpg', label: 'è€å¸ˆ' }, right: { img: BASE_URL + 'è¯¾æœ¬.jpg', label: 'è¯¾æœ¬' } },
  'chef': { left: { img: BASE_URL + 'å¨å¸ˆ.jpg', label: 'å¨å¸ˆ' }, right: { img: BASE_URL + 'å¹³åº•é”….jpg', label: 'å¹³åº•é”…' } },
  'painter': { left: { img: BASE_URL + 'ç”»å®¶.jpg', label: 'ç”»å®¶' }, right: { img: BASE_URL + 'ç”»ç¬”.jpg', label: 'ç”»ç¬”' } },
  'musician': { left: { img: BASE_URL + 'éŸ³ä¹å®¶.jpg', label: 'éŸ³ä¹å®¶' }, right: { img: BASE_URL + 'å‰ä»–.jpg', label: 'å‰ä»–' } },
  'mail': { left: { img: BASE_URL + 'é‚®é€’å‘˜.jpg', label: 'é‚®é€’å‘˜' }, right: { img: BASE_URL + 'ä¿¡ä»¶.jpg', label: 'ä¿¡ä»¶' } },
  'barber': { left: { img: BASE_URL + 'ç†å‘å¸ˆ.jpg', label: 'ç†å‘å¸ˆ' }, right: { img: BASE_URL + 'å‰ªåˆ€.jpg', label: 'å‰ªåˆ€' } },
  'builder': { left: { img: BASE_URL + 'å·¥äºº.jpg', label: 'å·¥äºº' }, right: { img: BASE_URL + 'é”¤å­.jpg', label: 'é”¤å­' } },
  'baker': { left: { img: BASE_URL + 'é¢åŒ…å¸ˆ.jpg', label: 'é¢åŒ…å¸ˆ' }, right: { img: BASE_URL + 'é¢åŒ….jpg', label: 'é¢åŒ…' } },
  'astronaut': { left: { img: BASE_URL + 'å®‡èˆªå‘˜.jpg', label: 'å®‡èˆªå‘˜' }, right: { img: BASE_URL + 'ç«ç®­.jpg', label: 'ç«ç®­' } },
  'pilot': { left: { img: BASE_URL + 'é£è¡Œå‘˜.jpg', label: 'é£è¡Œå‘˜' }, right: { img: BASE_URL + 'é£æœº.jpg', label: 'é£æœº' } },
  'knight': { left: { img: BASE_URL + 'éª‘å£«.jpg', label: 'éª‘å£«' }, right: { img: BASE_URL + 'ç›¾ç‰Œ.jpg', label: 'ç›¾ç‰Œ' } },
  'magician': { left: { img: BASE_URL + 'é­”æ³•å¸ˆ.jpg', label: 'é­”æ³•å¸ˆ' }, right: { img: BASE_URL + 'é­”æ³•æ£’.jpg', label: 'é­”æ³•æ£’' } },
  'gardener': { left: { img: BASE_URL + 'å›­ä¸.jpg', label: 'å›­ä¸' }, right: { img: BASE_URL + 'èŠ±æœµ.jpg', label: 'èŠ±æœµ' } },
  'farmer': { left: { img: BASE_URL + 'å†œå¤«.jpg', label: 'å†œå¤«' }, right: { img: BASE_URL + 'æ‹–æ‹‰æœº.jpg', label: 'æ‹–æ‹‰æœº' } },
  'fisher': { left: { img: BASE_URL + 'æ¸”å¤«.jpg', label: 'æ¸”å¤«' }, right: { img: BASE_URL + 'é±¼ç«¿.jpg', label: 'é±¼ç«¿' } },
  'diver': { left: { img: BASE_URL + 'æ½œæ°´å‘˜.jpg', label: 'æ½œæ°´å‘˜' }, right: { img: BASE_URL + 'æŠ¤ç›®é•œ.jpg', label: 'æŠ¤ç›®é•œ' } },
  'singer': { left: { img: BASE_URL + 'æ­Œæ‰‹.jpg', label: 'æ­Œæ‰‹' }, right: { img: BASE_URL + 'éº¦å…‹é£.jpg', label: 'éº¦å…‹é£' } },
  'photo': { left: { img: BASE_URL + 'æ‘„å½±å¸ˆ.jpg', label: 'æ‘„å½±å¸ˆ' }, right: { img: BASE_URL + 'ç›¸æœº.jpg', label: 'ç›¸æœº' } },
  'writer': { left: { img: BASE_URL + 'å†™ä½œè€….jpg', label: 'å†™ä½œè€…' }, right: { img: BASE_URL + 'é“…ç¬”.jpg', label: 'é“…ç¬”' } },
  
  // å…¶ä»–æ˜ å°„
  'car': { left: { img: BASE_URL + 'æ±½è½¦.jpg', label: 'æ±½è½¦' }, right: { img: BASE_URL + 'è½®å­.jpg', label: 'è½®å­' } },
  'train': { left: { img: BASE_URL + 'ç«è½¦.jpg', label: 'ç«è½¦' }, right: { img: BASE_URL + 'é“è½¨.jpg', label: 'é“è½¨' } },
  'rain': { left: { img: BASE_URL + 'ä¸‹é›¨.jpg', label: 'ä¸‹é›¨' }, right: { img: BASE_URL + 'é›¨ä¼.jpg', label: 'é›¨ä¼' } },
  'sun': { left: { img: BASE_URL + 'å¤ªé˜³.jpg', label: 'å¤ªé˜³' }, right: { img: BASE_URL + 'å¤ªé˜³å¸½.jpg', label: 'å¤ªé˜³å¸½' } },
  'pirate': { left: { img: BASE_URL + 'æµ·ç›—.jpg', label: 'æµ·ç›—' }, right: { img: BASE_URL + 'å®è—.jpg', label: 'å®è—' } },
  'swimmer': { left: { img: BASE_URL + 'æ¸¸æ³³.jpg', label: 'æ¸¸æ³³' }, right: { img: BASE_URL + 'æŠ¤ç›®é•œ.jpg', label: 'æŠ¤ç›®é•œ' } }
};

/* =========== é¢˜åº“é…ç½® =========== */
const DECK_MAIN = [
  { id:'dog', left:'å°ç‹—', right:'éª¨å¤´' }, { id:'cat', left:'å°çŒ«', right:'å°é±¼' },
  { id:'rabbit', left:'å…”å­', right:'èƒ¡èåœ' }, { id:'panda', left:'ç†ŠçŒ«', right:'ç«¹å­' },
  { id:'penguin', left:'ä¼é¹…', right:'å†°å—' }, { id:'elephant', left:'å¤§è±¡', right:'èŠ±ç”Ÿ' },
  { id:'monkey', left:'çŒ´å­', right:'é¦™è•‰' }, { id:'squirrel', left:'æ¾é¼ ', right:'æ©¡æœ' },
  { id:'cow', left:'å¥¶ç‰›', right:'ç‰›å¥¶' }, { id:'pig', left:'å°çŒª', right:'çŒªåœˆ' },
  { id:'chicken', left:'æ¯é¸¡', right:'é¸¡è›‹' }, { id:'sheep', left:'ç»µç¾Š', right:'ç¾Šæ¯›' },
  { id:'horse', left:'é©¬', right:'é©¬è¹„é“' }, { id:'turtle', left:'ä¹Œé¾Ÿ', right:'æ± å¡˜' },
  { id:'bee', left:'èœœèœ‚', right:'èœ‚èœœ' }, { id:'bird', left:'å°é¸Ÿ', right:'é¸Ÿå·¢' },
  { id:'frog', left:'é’è›™', right:'å°é£è™«' }, { id:'fox', left:'ç‹ç‹¸', right:'æ´ç©´' },
  { id:'koala', left:'è€ƒæ‹‰', right:'æ¡‰æ ‘å¶' }, { id:'owl', left:'çŒ«å¤´é¹°', right:'ä¹¦æœ¬' }
];

const DECK_ANIMALS = [
  { id:'rabbit', left:'å…”å­', right:'èƒ¡èåœ' }, { id:'panda', left:'ç†ŠçŒ«', right:'ç«¹å­' },
  { id:'monkey', left:'çŒ´å­', right:'é¦™è•‰' }, { id:'dog', left:'å°ç‹—', right:'éª¨å¤´' },
  { id:'cat', left:'å°çŒ«', right:'å°é±¼' }, { id:'squirrel', left:'æ¾é¼ ', right:'æ©¡æœ' },
  { id:'bird', left:'å°é¸Ÿ', right:'é¸Ÿå·¢' }, { id:'penguin', left:'ä¼é¹…', right:'å†°å—' }
];

const DECK_JOBS = [
  { id:'doctor', left:'åŒ»ç”Ÿ', right:'å¬è¯Šå™¨' }, { id:'teacher', left:'è€å¸ˆ', right:'è¯¾æœ¬' },
  { id:'police', left:'è­¦å¯Ÿ', right:'è­¦è½¦' }, { id:'fire', left:'æ¶ˆé˜²å‘˜', right:'ç­ç«å™¨' },
  { id:'chef', left:'å¨å¸ˆ', right:'å¹³åº•é”…' }, { id:'farmer', left:'å†œå¤«', right:'æ‹–æ‹‰æœº' },
  { id:'painter', left:'ç”»å®¶', right:'ç”»ç¬”' }, { id:'musician', left:'éŸ³ä¹å®¶', right:'å‰ä»–' }
];

const DECKS = { main: DECK_MAIN, animals: DECK_ANIMALS, jobs: DECK_JOBS };

/* =========== æ¸¸æˆæ ¸å¿ƒé€»è¾‘ =========== */
const $ = (s,r=document)=>r.querySelector(s);
const $$ = (s,r=document)=>Array.from(r.querySelectorAll(s));
const rnd=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
const shuffle=a=>{a=a.slice();for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a};
const setStatus=t=>$('#status').textContent=t;

const state={selected:null,lines:[],pairCount:0,activePairs:[],rect:null,temp:null};
const board=$('#board'), svg=$('#wires'), leftCol=$('#leftCol'), rightCol=$('#rightCol');
const selDiff=$('#difficulty'), selDeck=$('#deck');
const btnNew=$('#newGame'), btnHint=$('#giveHint');
const btnRestart=$('#restart'), btnLevelUp=$('#levelUp');
const modal=$('#modal'), modalBadge=$('#modalBadge'), modalTitle=$('#modalTitle'), modalMsg=$('#modalMsg');
const modalRestart=$('#modalRestart'), modalLevelUp=$('#modalLevelUp');

/* =========== å¸ƒå±€&è¿çº¿ =========== */
const boardRect=()=> (state.rect=board.getBoundingClientRect(), state.rect);
function anchorPoint(el){
  const r=el.getBoundingClientRect(), b=boardRect();
  const side=el.dataset.side;
  const offset=6;
  const x = side==='left' ? (r.right - b.left - offset) : (r.left - b.left + offset);
  const y = r.top - b.top + r.height/2;
  return {x,y};
}
function makeLine(x1,y1,x2,y2,cls='neutral'){
  const ln=document.createElementNS('http://www.w3.org/2000/svg','line');
  ln.setAttribute('x1',x1); ln.setAttribute('y1',y1);
  ln.setAttribute('x2',x2); ln.setAttribute('y2',y2);
  ln.setAttribute('class','wire '+cls);
  svg.appendChild(ln); return ln;
}
const updLine =(ln,x1,y1,x2,y2)=>{ 
  ln.setAttribute('x1',x1); ln.setAttribute('y1',y1); 
  ln.setAttribute('x2',x2); ln.setAttribute('y2',y2); 
};
function drawPermanent(a,b){ 
  const A=anchorPoint(a), B=anchorPoint(b); 
  const ln=makeLine(A.x,A.y,B.x,B.y,'good'); 
  state.lines.push({leftEl:a,rightEl:b,lineEl:ln}); 
}
function redrawAll(){ 
  boardRect(); 
  state.lines.forEach(r=>{ 
    const A=anchorPoint(r.leftEl), B=anchorPoint(r.rightEl); 
    updLine(r.lineEl,A.x,A.y,B.x,B.y); 
  }); 
}

/* =========== æ¸²æŸ“ç³»ç»Ÿ =========== */
function cardHTML(side, item){
  const config = IMAGE_MAP[item.id];
  const imgData = side === 'left' ? config.left : config.right;
  return `
    <div class="card" data-side="${side}" data-id="${item.id}" tabindex="0" role="button" aria-label="${imgData.label}">
      <div class="img-box">
        <img src="${imgData.img}" alt="${imgData.label}" loading="lazy">
      </div>
      <div class="label">${imgData.label}</div>
    </div>
  `;
}

function renderBoard(){
  svg.innerHTML=''; leftCol.innerHTML=''; rightCol.innerHTML='';
  state.lines=[]; state.selected=null;
  const L=shuffle(state.activePairs.map(p=>({id:p.id,label:p.left})));
  const R=shuffle(state.activePairs.map(p=>({id:p.id,label:p.right})));
  L.forEach(x=>leftCol.insertAdjacentHTML('beforeend', cardHTML('left', x)));
  R.forEach(x=>rightCol.insertAdjacentHTML('beforeend', cardHTML('right', x)));
  attachEvents();
  setStatus(`è¯·å¼€å§‹è¿çº¿ï¼šå·²é…å¯¹ 0 / ${state.pairCount} å¯¹`);
  setTimeout(boardRect, 80);
}

/* =========== äº¤äº’ç³»ç»Ÿ =========== */
function attachEvents(){ 
  $$('.card',leftCol).forEach(bindCard); 
  $$('.card',rightCol).forEach(bindCard); 
}
function bindCard(el){
  el.addEventListener('click', e=>{ 
    e.preventDefault(); 
    if(el.classList.contains('locked')) return; 
    selectCard(el); 
  });
  el.addEventListener('pointerdown', e=>{ 
    if(el.classList.contains('locked')) return; 
    startDrag(el,e); 
  });
}

function selectCard(el){
  if(state.selected===el){ 
    el.classList.remove('selecting'); 
    state.selected=null; 
    return; 
  }
  $$('.card.selecting').forEach(n=>n.classList.remove('selecting'));
  el.classList.add('selecting'); 
  state.selected=el;
}

function startDrag(startEl,e){
  selectCard(startEl); 
  boardRect();
  const A=anchorPoint(startEl);
  const temp=makeLine(A.x,A.y,A.x,A.y,'neutral'); 
  temp.classList.add('temp'); 
  state.temp=temp;

  const move=ev=>{ 
    const pt=toBoardPoint(ev.clientX,ev.clientY); 
    updLine(temp,A.x,A.y,pt.x,pt.y); 
  };
  const end =ev=>{
    cleanup();
    let hit = document.elementFromPoint(ev.clientX, ev.clientY);
    hit = hit && hit.closest && hit.closest('.card');
    let target = (hit && hit.dataset.side!==startEl.dataset.side && !hit.classList.contains('locked')) ? hit : null;
    if(!target){ target = nearestOpposite(startEl.dataset.side, ev.clientX, ev.clientY, autoRadius()); }
    if(target) tryConnect(startEl, target);
  };
  const cleanup=()=>{ 
    document.removeEventListener('pointermove',move); 
    document.removeEventListener('pointerup',end); 
    document.removeEventListener('pointercancel',end); 
    if(state.temp?.parentNode) state.temp.remove(); 
    state.temp=null; 
  };
  
  document.addEventListener('pointermove', move, {passive:true});
  document.addEventListener('pointerup', end);
  document.addEventListener('pointercancel', end);
}

const toBoardPoint=(cx,cy)=>{ 
  const b=boardRect(); 
  return {
    x:Math.max(0,Math.min(cx-b.left,b.width)), 
    y:Math.max(0,Math.min(cy-b.top,b.height))
  }; 
};

function autoRadius(){ 
  const b=boardRect(); 
  return Math.max(80, Math.min(160, Math.min(b.width,b.height)/5)); 
}

function nearestOpposite(side,cx,cy,r){
  const list=$$('.card').filter(el=>el.dataset.side!==side && !el.classList.contains('locked'));
  let best=null, bestD=Infinity;
  list.forEach(el=>{ 
    const rect=el.getBoundingClientRect(); 
    const x=rect.left+rect.width/2, y=rect.top+rect.height/2;
    const d=Math.hypot(cx-x, cy-y); 
    if(d<bestD){ bestD=d; best=el; } 
  });
  return bestD<=r ? best : null;
}

function tryConnect(a,b){
  if(a.classList.contains('locked')||b.classList.contains('locked')){
    shake(a);shake(b);return;
  }
  if(a.dataset.side===b.dataset.side){shake(a);shake(b);return;}
  const ok=a.dataset.id===b.dataset.id;
  if(ok){ 
    a.classList.add('locked','selecting'); 
    b.classList.add('locked'); 
    drawPermanent(a,b); 
    onProgress(); 
    pulse(a); 
  } else { 
    wrongFlash(a,b); 
  }
  $$('.card.selecting').forEach(n=>n.classList.remove('selecting')); 
  state.selected=null;
}

const shake=el=>{ 
  el.classList.add('shake'); 
  setTimeout(()=>el.classList.remove('shake'),250); 
};

function wrongFlash(a,b){ 
  const A=anchorPoint(a), B=anchorPoint(b); 
  const bad=makeLine(A.x,A.y,B.x,B.y,'bad'); 
  bad.classList.add('temp'); 
  setTimeout(()=>bad.remove(),420); 
}

function pulse(el){ 
  el.animate?.([{
    transform:'scale(1)'},
    {transform:'scale(1.03)'}
  ],{duration:220,easing:'ease-out'}); 
}

/* =========== è¿›åº¦ç³»ç»Ÿ =========== */
function onProgress(){
  const done=state.lines.length;
  setStatus(`å·²é…å¯¹ ${done} / ${state.pairCount} å¯¹`);
  if(done===state.pairCount){ 
    showModal('win'); 
    confetti(); 
  }
}

function showModal(type){
  if(type==='win'){
    modalBadge.textContent='ğŸ‰ èƒœåˆ©';
    modalTitle.textContent='å®è´ä½ çœŸæ£’ï¼';
    modalMsg.textContent='å…¨éƒ¨é…å¯¹å®Œæˆï¼å†æ¥ä¸€å±€æˆ–å‡çº§éš¾åº¦ç»§ç»­æŒ‘æˆ˜å§ï½';
  }else{
    modalBadge.textContent='ğŸ™‚ å†è¯•è¯•';
    modalTitle.textContent='ä¸è¦ç´§ï¼Œç»§ç»­åŠ æ²¹ï¼';
    modalMsg.textContent='å¯ä»¥è°ƒæ•´éš¾åº¦å†æ¥ä¸€æ¬¡ã€‚';
  }
  modal.classList.add('show');
}

function hideModal(){ 
  modal.classList.remove('show'); 
}

function confetti(){
  const layer=document.createElement('div'); 
  layer.className='confetti'; 
  document.body.appendChild(layer);
  const colors=['#FF8A3D','#FFC93A','#6FCF6A','#FF76A8','#50B7F5'];
  for(let i=0;i<90;i++){ 
    const p=document.createElement('i'); 
    p.style.left=rnd(0,100)+'vw'; 
    p.style.background=colors[rnd(0,colors.length-1)];
    p.style.animationDuration=(rnd(8,14)/10)+'s'; 
    p.style.animationDelay=(rnd(0,10)/10)+'s'; 
    p.style.transform=`translateY(-100px) rotate(${rnd(0,360)}deg)`; 
    layer.appendChild(p); 
  }
  setTimeout(()=>layer.remove(),2600);
}

/* =========== æ§ä»¶åŠŸèƒ½ =========== */
function pickDeck(){ 
  const key=selDeck.value; 
  return (DECKS[key]||DECK_MAIN).slice(); 
}

function newGame(){
  const need=parseInt(selDiff.value,10)||4;
  const pool=shuffle(pickDeck());
  const chosen = pool.length>=need ? pool.slice(0,need) : pool;
  
  // éªŒè¯æ‰€æœ‰é€‰æ‹©çš„é…å¯¹éƒ½æœ‰å¯¹åº”çš„å›¾ç‰‡
  const validPairs = chosen.filter(pair => IMAGE_MAP[pair.id]);
  
  state.activePairs=validPairs; 
  state.pairCount=validPairs.length; 
  renderBoard(); 
  hideModal();
}

function restart(){ 
  newGame(); 
}

function levelUp(){
  const n=parseInt(selDiff.value,10)||4;
  if(n<8) selDiff.value = String(n===4?6:8);
  newGame();
}

function hint(){
  const pool=$$('.card').filter(el=>!el.classList.contains('locked')); 
  if(!pool.length) return;
  const lefts=pool.filter(el=>el.dataset.side==='left');
  const pick=(lefts.length?lefts:pool)[rnd(0,(lefts.length?lefts:pool).length-1)];
  const mate=$(`.card[data-side="${pick.dataset.side==='left'?'right':'left'}"][data-id="${pick.dataset.id}"]`);
  [pick,mate].forEach(el=>{
    el.animate?.([
      {boxShadow:'0 0 0 0 rgba(255,179,26,.8)'},
      {boxShadow:'0 0 0 14px rgba(255,179,26,0)'}
    ],{duration:650,easing:'ease-out'});
  });
}

/* =========== äº‹ä»¶ç»‘å®š =========== */
btnNew.addEventListener('click', newGame);
btnHint.addEventListener('click', hint);
btnRestart.addEventListener('click', restart);
btnLevelUp.addEventListener('click', levelUp);
modalRestart.addEventListener('click', ()=>{ restart(); hideModal(); });
modalLevelUp.addEventListener('click', ()=>{ levelUp(); hideModal(); });
modal.addEventListener('click', e=>{ if(e.target===modal) hideModal(); });
window.addEventListener('resize', ()=> setTimeout(redrawAll, 80));

/* =========== åˆå§‹å¼€å±€ =========== */
window.addEventListener('DOMContentLoaded', ()=>{ 
  console.log('é­”æ³•è¿çº¿ç½‘ç»œç‰ˆå·²åŠ è½½ï¼');
  newGame(); 
});
</script>
</body>
</html>